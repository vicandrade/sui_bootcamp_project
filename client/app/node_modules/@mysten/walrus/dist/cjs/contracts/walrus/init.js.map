{
  "version": 3,
  "sources": ["../../../../src/contracts/walrus/init.ts"],
  "sourcesContent": ["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\nimport { MoveStruct, normalizeMoveArguments } from '../utils/index.js';\nimport type { RawTransactionArgument } from '../utils/index.js';\nimport { bcs } from '@mysten/sui/bcs';\nimport type { Transaction } from '@mysten/sui/transactions';\nimport * as object from './deps/sui/object.js';\nimport * as _package from './deps/sui/package.js';\nconst $moduleName = '@local-pkg/walrus::init';\nexport const INIT = new MoveStruct({\n\tname: `${$moduleName}::INIT`,\n\tfields: {\n\t\tdummy_field: bcs.bool(),\n\t},\n});\nexport const InitCap = new MoveStruct({\n\tname: `${$moduleName}::InitCap`,\n\tfields: {\n\t\tid: object.UID,\n\t\tpublisher: _package.Publisher,\n\t},\n});\nexport interface InitializeWalrusArguments {\n\tinitCap: RawTransactionArgument<string>;\n\tupgradeCap: RawTransactionArgument<string>;\n\tepochZeroDuration: RawTransactionArgument<number | bigint>;\n\tepochDuration: RawTransactionArgument<number | bigint>;\n\tnShards: RawTransactionArgument<number>;\n\tmaxEpochsAhead: RawTransactionArgument<number>;\n}\nexport interface InitializeWalrusOptions {\n\tpackage?: string;\n\targuments:\n\t\t| InitializeWalrusArguments\n\t\t| [\n\t\t\t\tinitCap: RawTransactionArgument<string>,\n\t\t\t\tupgradeCap: RawTransactionArgument<string>,\n\t\t\t\tepochZeroDuration: RawTransactionArgument<number | bigint>,\n\t\t\t\tepochDuration: RawTransactionArgument<number | bigint>,\n\t\t\t\tnShards: RawTransactionArgument<number>,\n\t\t\t\tmaxEpochsAhead: RawTransactionArgument<number>,\n\t\t  ];\n}\n/**\n * Initializes Walrus and shares the system and staking objects.\n *\n * This can only be called once, after which the `InitCap` is destroyed.\n */\nexport function initializeWalrus(options: InitializeWalrusOptions) {\n\tconst packageAddress = options.package ?? '@local-pkg/walrus';\n\tconst argumentsTypes = [\n\t\t`${packageAddress}::init::InitCap`,\n\t\t'0x0000000000000000000000000000000000000000000000000000000000000002::package::UpgradeCap',\n\t\t'u64',\n\t\t'u64',\n\t\t'u16',\n\t\t'u32',\n\t\t'0x0000000000000000000000000000000000000000000000000000000000000002::clock::Clock',\n\t] satisfies string[];\n\tconst parameterNames = [\n\t\t'initCap',\n\t\t'upgradeCap',\n\t\t'epochZeroDuration',\n\t\t'epochDuration',\n\t\t'nShards',\n\t\t'maxEpochsAhead',\n\t];\n\treturn (tx: Transaction) =>\n\t\ttx.moveCall({\n\t\t\tpackage: packageAddress,\n\t\t\tmodule: 'init',\n\t\t\tfunction: 'initialize_walrus',\n\t\t\targuments: normalizeMoveArguments(options.arguments, argumentsTypes, parameterNames),\n\t\t});\n}\nexport interface MigrateArguments {\n\tstaking: RawTransactionArgument<string>;\n\tsystem: RawTransactionArgument<string>;\n}\nexport interface MigrateOptions {\n\tpackage?: string;\n\targuments:\n\t\t| MigrateArguments\n\t\t| [staking: RawTransactionArgument<string>, system: RawTransactionArgument<string>];\n}\n/**\n * Migrates the staking and system objects to the new package ID.\n *\n * This must be called in the new package after an upgrade is committed to emit an\n * event that informs all storage nodes and prevent previous package versions from\n * being used.\n *\n * Requires the migration epoch to be set first on the staking object, which then\n * enables the migration at the start of the next epoch.\n */\nexport function migrate(options: MigrateOptions) {\n\tconst packageAddress = options.package ?? '@local-pkg/walrus';\n\tconst argumentsTypes = [\n\t\t`${packageAddress}::staking::Staking`,\n\t\t`${packageAddress}::system::System`,\n\t] satisfies string[];\n\tconst parameterNames = ['staking', 'system'];\n\treturn (tx: Transaction) =>\n\t\ttx.moveCall({\n\t\t\tpackage: packageAddress,\n\t\t\tmodule: 'init',\n\t\t\tfunction: 'migrate',\n\t\t\targuments: normalizeMoveArguments(options.arguments, argumentsTypes, parameterNames),\n\t\t});\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,mBAAmD;AAEnD,iBAAoB;AAEpB,aAAwB;AACxB,eAA0B;AAC1B,MAAM,cAAc;AACb,MAAM,OAAO,IAAI,wBAAW;AAAA,EAClC,MAAM,GAAG,WAAW;AAAA,EACpB,QAAQ;AAAA,IACP,aAAa,eAAI,KAAK;AAAA,EACvB;AACD,CAAC;AACM,MAAM,UAAU,IAAI,wBAAW;AAAA,EACrC,MAAM,GAAG,WAAW;AAAA,EACpB,QAAQ;AAAA,IACP,IAAI,OAAO;AAAA,IACX,WAAW,SAAS;AAAA,EACrB;AACD,CAAC;AA2BM,SAAS,iBAAiB,SAAkC;AAClE,QAAM,iBAAiB,QAAQ,WAAW;AAC1C,QAAM,iBAAiB;AAAA,IACtB,GAAG,cAAc;AAAA,IACjB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD;AACA,QAAM,iBAAiB;AAAA,IACtB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD;AACA,SAAO,CAAC,OACP,GAAG,SAAS;AAAA,IACX,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,eAAW,qCAAuB,QAAQ,WAAW,gBAAgB,cAAc;AAAA,EACpF,CAAC;AACH;AAqBO,SAAS,QAAQ,SAAyB;AAChD,QAAM,iBAAiB,QAAQ,WAAW;AAC1C,QAAM,iBAAiB;AAAA,IACtB,GAAG,cAAc;AAAA,IACjB,GAAG,cAAc;AAAA,EAClB;AACA,QAAM,iBAAiB,CAAC,WAAW,QAAQ;AAC3C,SAAO,CAAC,OACP,GAAG,SAAS;AAAA,IACX,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,eAAW,qCAAuB,QAAQ,WAAW,gBAAgB,cAAc;AAAA,EACpF,CAAC;AACH;",
  "names": []
}
