{
  "version": 3,
  "sources": ["../../../src/storage-node/error.ts"],
  "sourcesContent": ["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nexport class StorageNodeError extends Error {}\n\nexport class StorageNodeAPIError<\n\tTStatus extends number | undefined = number | undefined,\n\tTError extends object | undefined = object | undefined,\n> extends StorageNodeError {\n\t/** HTTP status for the response that caused the error. */\n\treadonly status: TStatus;\n\n\t/** JSON body of the response that caused the error. */\n\treadonly error: TError;\n\n\tconstructor(status: TStatus, error: TError, message: string | undefined) {\n\t\tsuper(StorageNodeAPIError.#makeMessage(status, error, message));\n\t\tthis.status = status;\n\t\tthis.error = error;\n\t}\n\n\tstatic #makeMessage(status: number | undefined, error: unknown, message: string | undefined) {\n\t\tfunction hasErrorMessage(error: any): error is { error: { message: string } } {\n\t\t\treturn typeof error?.error?.message === 'string';\n\t\t}\n\n\t\tconst inferredMessage = hasErrorMessage(error) ? error.error.message : message;\n\t\tconst finalMessage = inferredMessage ? inferredMessage : JSON.stringify(error);\n\n\t\tif (status && finalMessage) {\n\t\t\treturn `${status} ${finalMessage}`;\n\t\t} else if (finalMessage) {\n\t\t\treturn finalMessage;\n\t\t} else if (status) {\n\t\t\treturn `${status} status code (no body)`;\n\t\t}\n\t\treturn '(no status code or body)';\n\t}\n\n\tstatic generate(\n\t\tstatus: number | undefined,\n\t\terrorResponse: object | undefined,\n\t\tmessage: string | undefined,\n\t): StorageNodeAPIError {\n\t\tif (!status) {\n\t\t\treturn new ConnectionError({ message });\n\t\t}\n\n\t\tif (status === 400) {\n\t\t\treturn BadRequestError.generate(status, errorResponse, message);\n\t\t}\n\n\t\tif (status === 401) {\n\t\t\treturn new AuthenticationError(status, errorResponse, message);\n\t\t}\n\n\t\tif (status === 403) {\n\t\t\treturn new PermissionDeniedError(status, errorResponse, message);\n\t\t}\n\n\t\tif (status === 404) {\n\t\t\treturn new NotFoundError(status, errorResponse, message);\n\t\t}\n\n\t\tif (status === 409) {\n\t\t\treturn new ConflictError(status, errorResponse, message);\n\t\t}\n\n\t\tif (status === 422) {\n\t\t\treturn new UnprocessableEntityError(status, errorResponse, message);\n\t\t}\n\n\t\tif (status === 429) {\n\t\t\treturn new RateLimitError(status, errorResponse, message);\n\t\t}\n\n\t\tif (status === 451) {\n\t\t\treturn new LegallyUnavailableError(status, errorResponse, message);\n\t\t}\n\n\t\tif (status >= 500) {\n\t\t\treturn new InternalServerError(status, errorResponse, message);\n\t\t}\n\n\t\treturn new StorageNodeAPIError(status, errorResponse, message);\n\t}\n}\n\nexport class UserAbortError extends StorageNodeAPIError<undefined, undefined> {\n\tconstructor({ message }: { message?: string } = {}) {\n\t\tsuper(undefined, undefined, message || 'Request was aborted.');\n\t}\n}\n\nexport class ConnectionError extends StorageNodeAPIError<undefined, undefined> {\n\tconstructor({ message }: { message?: string | undefined }) {\n\t\tsuper(undefined, undefined, message || 'Connection error.');\n\t}\n}\n\nexport class ConnectionTimeoutError extends StorageNodeAPIError<undefined, undefined> {\n\tconstructor({ message }: { message?: string } = {}) {\n\t\tsuper(undefined, undefined, message ?? 'Request timed out.');\n\t}\n}\n\nexport class BadRequestError extends StorageNodeAPIError<400> {\n\tstatic generate(\n\t\tstatus: 400,\n\t\terrorResponse: object | undefined,\n\t\tmessage: string | undefined,\n\t): StorageNodeAPIError {\n\t\tif (errorResponse && typeof errorResponse === 'object' && 'error' in errorResponse) {\n\t\t\tconst error = errorResponse.error as {\n\t\t\t\tdetails?: [\n\t\t\t\t\t{\n\t\t\t\t\t\treason?: string;\n\t\t\t\t\t},\n\t\t\t\t];\n\t\t\t};\n\t\t\tif (error.details?.[0]?.reason === 'NOT_REGISTERED') {\n\t\t\t\treturn new BlobNotRegisteredError(errorResponse, message);\n\t\t\t}\n\t\t}\n\n\t\treturn new BadRequestError(status, errorResponse, message);\n\t}\n}\n\nexport class BlobNotRegisteredError extends StorageNodeAPIError<400> {\n\tconstructor(error: object | undefined, message: string | undefined) {\n\t\tsuper(400, error, message);\n\t}\n}\n\nexport class AuthenticationError extends StorageNodeAPIError<401> {}\n\nexport class PermissionDeniedError extends StorageNodeAPIError<403> {}\n\nexport class NotFoundError extends StorageNodeAPIError<404> {}\n\nexport class ConflictError extends StorageNodeAPIError<409> {}\n\nexport class UnprocessableEntityError extends StorageNodeAPIError<422> {}\n\nexport class RateLimitError extends StorageNodeAPIError<429> {}\n\nexport class LegallyUnavailableError extends StorageNodeAPIError<451> {}\n\nexport class InternalServerError extends StorageNodeAPIError<number> {}\n"],
  "mappings": "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",
  "names": ["error"]
}
